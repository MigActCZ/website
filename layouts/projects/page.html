{{ define "scripts" }}
<link rel="stylesheet" href="/photoswipe.css">
<script type="module">
  import PhotoSwipeLightbox from '/photoswipe-lightbox.esm.min.js';
  const lightbox = new PhotoSwipeLightbox({
    gallery: '#gallery',
    children: 'a',
    pswpModule: () => import('/photoswipe.esm.min.js')
  });
  lightbox.init();
  </script>
  <script src='{{ (resources.Get "utility.js").Permalink }}'></script>
{{ end }}
{{ define "main" }}
<main id="project" class="{{ .Kind }}">
    <h1>{{ .Title }}</h1>
    <dl class="attributes">
      <div><dt>{{ i18n "status" }}</dt>
        <dd class="status"></dd>
      </div>
      <div><dt>{{ i18n "timeline" }}</dt>
        <dd class="timeline">
          <time datetime='{{ .Params.dtstart }}'>
            {{ .Params.dtstart | dateFormat "2 Jan 2006" }}</time>
          -
          <time datetime='{{ .Params.dtend }}'>
            {{ .Params.dtend | dateFormat "2 Jan 2006" }}</time>
        </dd></div>
      {{ with .Params.partner }}
      {{ $partnersPage := site.GetPage "partners" }}
      <div>
        <dt>{{ i18n "partners" }}</dt>
        <div>
          <dd class="partners">
            {{ $partnerPage := $partnersPage.GetPage . }}
            {{ $image := $partnerPage.Resources.GetMatch "logo.*" }}
            <img class="partner-logo" src="{{ $image.Permalink }}" alt="Logo of {{ $partnerPage.Title }}">
          </dd>
          {{ range $.Params.supporters }}
          <dd class="partners">
            {{ $partnerPage := $partnersPage.GetPage . }}
            {{ $image := $partnerPage.Resources.GetMatch "logo.*" }}
            <img class="partner-logo" src="{{ $image.Permalink }}" alt="Logo of {{ $partnerPage.Title }}">
          </dd>
          {{ end }}
        </div>
      </div>
      {{ end }}
    </dl>
    {{ .Content }}
    {{ $events := site.GetPage "events" }}
    {{ $key := path.Base $.Path }}
    {{ $related := where $events.RegularPages "Params.project" $key }}
    {{ with $related }}
      <section>
      <h2>{{ i18n "linked_events" }}</h2>
        {{ range . }}
          <article>
            <div>{{ .Params.dtstart | dateFormat "2 Jan 2006" }}</div>
            <a href="{{ .Permalink }}">{{ .Title }}</a>
          </article>
        {{ end }}
      </section>
    {{ end }}
    {{ with .Params.images }}
      <section>
        <h2>Gallery</h2>
        <div id="gallery">
          {{ range . }}
          {{ $image := $.Resources.Get . }}
          <a href="{{ $image.Permalink }}"
          data-pswp-width="{{ $image.Width }}" 
          data-pswp-height="{{ $image.Height }}">
            <img src="{{ $image.Permalink }}" alt="{{ . }}">
          </a>
          {{ end }}
        </div>
      </section>
    {{ end }}
</main>
{{ end }}
{{ define "inline-scripts" }}
<script>
    const vals = {
        active: {{ i18n "ongoing" }},
        archived: {{ i18n "finished" }}
    };
    window.updatePageStatusTag(vals);
</script>
{{ end }}